# Vue Element Pro（ 一 ）

<a name="AplED"></a>
## 项目简述
基于 Element 开发中后台，包含路由配置以及权限管理。

<a name="R2UYO"></a>
## 项目构建
[Vue CLI 3](https://cli.vuejs.org/zh/) 基于 Vue.js 搭建交互式的项目脚手架** ( Node.js > 8.9 )**

```basic
# install
npm install -g @vue/cli
# OR
yarn global add @vue/cli

# create
vue create vue-element
```

自定义配置，Manually select features ：

- Babel
- Router
- CSS Pre-processors
- Linter / Formatter
- Use history mode for router ? Y
- Pick a CSS pre-processor >  Less
- Pick a linter / formatter config > ESLint + Prettier
- Pick additional lint features > Lint on save & Lint and fix on commit
- Where do you prefer placing config > In dedicated config files

安装完毕进入开发目录，并开启开发进程：

```bash
cd vue-element
npm run serve
```

<a name="KlZOX"></a>
## 依赖安装

```basic
npm i element-ui -S
```

参考 [完全引入指南](https://element.eleme.io/#/zh-CN/component/quickstart)，全局安装 Element 及相关依赖，在 main.js 中写下以下内容：

```javascript
// 引入
import ElementUI from "element-ui";
import "element-ui/lib/theme-chalk/index.css";
// 使用
Vue.use(ElementUI);
```

在 views/Home.vue 中，使用 button 组件并观察页面，证明引用成功。

```jsx
<template>
  <div class="home">
    <img alt="Vue logo" src="../assets/logo.png" />
    <el-button type="primary">成功按钮</el-button>
    <HelloWorld msg="Welcome to Your Vue.js App" />
  </div>
</template>
```

> 安装依赖包时候暂停进程，安装完毕需要重新 npm run serve 重新启动开发进程。


<a name="ynvWa"></a>
## 页面配置
在本次项目中主要涉及到以下页面：

- 登录页 （ AccountLogin.vue )
- 概览页（ Dashboard.vue )
- 文章 - 文章分类 （ ArticleClassify.vue )
- 文章 - 文章管理 - 列表页（ ArticleIndex.vue )
- 文章 - 文章管理 - 创建页（ ArticleCreate.vue ）
- 文章 - 文章管理 - 编辑页（ ArticleEdit.vue ）
- 文章 - 文章管理 - 详情页（ ArticleShow.vue ）
- 设置 - 企业信息（ SettingCompany.vue )
- 设置 - 管理员 - 列表页 （ SettingManager.vue )
- 设置 - 管理员 - 添加页 （ SettingManagerCreate.vue )
- 设置 - 管理员 - 编辑页 （ SettingManagerEdit.vue )
- 错误 - 404 （ Error404.vue )

在 views 目录中分别创建上述页面，在 templete 模版中作简单标记，例如 views/AccountLogin.vue :

```html
<template>
  <div>AccountLogin</div>
</template>

<script>
  export default {};
</script>

<style lang="less" scoped></style>
```

在 src 目录下新建 router 文件夹，包含 index.js（路由配置） 、routes.js（路由定义） 两个文件。

src/router/routes.js 用于配置路由地址和名称

```javascript
const AccountLogin = () =>
  import(/* webpackChunkName: "account" */ "@/views/AccountLogin.vue");
const Dashboard = () =>
  import(/* webpackChunkName: "Dashboard" */ "@/views/Dashboard.vue");
const ArticleIndex = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleIndex.vue");
const ArticleClassify = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleClassify.vue");
const ArticleCreate = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleCreate.vue");
const ArticleEdit = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleEdit.vue");
const ArticleShow = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleShow.vue");
const SettingCompany = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingCompany.vue");
const SettingManager = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManager.vue");
const SettingManagerCreate = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerCreate.vue");
const SettingManagerEdit = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerEdit.vue");
const Error404 = () =>
  import(/* webpackChunkName: "errorp" */ "@/views/Error404.vue");

export default [
  {
    path: "/login",
    component: AccountLogin,
    name: "AccountLogin"
  },
  {
    path: "/",
    name: "Dashboard",
    component: Dashboard
  },
  {
    path: "/article",
    name: "ArticleIndex",
    component: ArticleIndex
  },
  {
    path: "/article/classify",
    name: "ArticleClassify",
    component: ArticleClassify
  },
  {
    path: "/article/create",
    name: "ArticleCreate",
    component: ArticleCreate
  },
  {
    path: "/article/:id",
    name: "ArticleShow",
    component: ArticleShow
  },
  {
    path: "/article/:id/edit",
    name: "ArticleEdit",
    component: ArticleEdit
  },
  {
    path: "/setting/company",
    name: "SettingCompany",
    component: SettingCompany
  },
  {
    path: "/setting/manager",
    name: "SettingManager",
    component: SettingManager
  },
  {
    path: "/setting/manager/create",
    name: "SettingManagerCreate",
    component: SettingManagerCreate
  },
  {
    path: "/setting/manager/:id/edit",
    name: "SettingManagerEdit",
    component: SettingManagerEdit
  },
  {
    path: "/404",
    name: "Error404",
    component: Error404
  },
  {
    path: "*",
    redirect: { name: "Error404" }
  }
];
```

src/router/index.js 用于配置路由，同时我们可以使用当前流行的加载效果插件 nprogress。

```bash
npm i nprogress -S
```

```javascript
import Vue from "vue";
import Router from "vue-router";
import routes from "./routes.js";
import NProgress from "nprogress"; //加载条
import "nprogress/nprogress.css"; //加载条样式

Vue.use(Router);

const appRouter = new Router({
  mode: "history",
  routes: routes
});

// eslint-disable-next-line
appRouter.beforeEach((to, from, next) => {
  NProgress.start();
  next();
});

// eslint-disable-next-line
appRouter.afterEach((to, from) => {
  NProgress.done();
});

export default appRouter;
```

之后我们修改 main.js 让它引用我们新的路由配置文件 。

```javascript
import Vue from "vue";
import App from "./App.vue";
// import router from "./router";
import router from "./router/index.js";
import ElementUI from "element-ui";
import "element-ui/lib/theme-chalk/index.css";

Vue.use(ElementUI);
Vue.config.productionTip = false;

new Vue({
  router,
  render: h => h(App)
}).$mount("#app");

```

修改 App.vue 中的多余内容

```xml
<template>
  <div id="app">
    <router-view />
  </div>
</template>

<style lang="less">
body {
  margin: 0;
  font-family: "Avenir", Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  color: #2c3e50;
}
</style>
```

接下来，删除多余的文件：

- src/router.js
- src/views/Home.vue
- src/views/About.vue
- src/components/HelloWorld.vue

最后打开我们定义的路由地址，一个个页面确认配置是否成功：

- [http://localhost:8080/](http://localhost:8080/)
- [http://localhost:8080/login](http://localhost:8080/login)
- [http://localhost:8080/article](http://localhost:8080/article)
- [http://localhost:8080/article/classify](http://localhost:8080/article/classify)
- [http://localhost:8080/article/create](http://localhost:8080/article/create)
- [http://localhost:8080/article/1](http://localhost:8080/article/1)
- [http://localhost:8080/article/1/edit](http://localhost:8080/article/1/edit)
- [http://localhost:8080/setting/company](http://localhost:8080/setting/company)
- [http://localhost:8080/setting/manager](http://localhost:8080/setting/manager)
- [http://localhost:8080/setting/manager/create](http://localhost:8080/setting/manager/create)
- [http://localhost:8080/setting/manager/1/edit](http://localhost:8080/setting/manager/1/edit)
- [http://localhost:8080/404](http://localhost:8080/404)

<a name="B8MEo"></a>
## 登录页开发
完成常规的登录页功能开发，包括密码登录和验证码登录，当教研通过时候跳转到后台首页。<br />验证模块参考 Form 组件表单验证模块：[https://element.eleme.io/#/zh-CN/component/form](https://element.eleme.io/#/zh-CN/component/form)

![WeChat60364591c85e2164fad18b1816c5d025.png](https://cdn.nlark.com/yuque/0/2019/png/166094/1559558108345-de941e00-3536-4b46-9b62-59e3735d3d6d.png#align=left&display=inline&height=357&name=WeChat60364591c85e2164fad18b1816c5d025.png&originHeight=1654&originWidth=1676&size=19060&status=done&width=362)![WeChat154a8255eb8bd9ba00e522f6b41f7636.png](https://cdn.nlark.com/yuque/0/2019/png/166094/1559558118095-253bc773-3089-4e75-a067-26ad70da375a.png#align=left&display=inline&height=355&name=WeChat154a8255eb8bd9ba00e522f6b41f7636.png&originHeight=1656&originWidth=1680&size=20684&status=done&width=360)

参考代码：src/views/AccountLogin.vue

```xml
<template>
  <div class="account-login-contaienr">
    <div class="account-login-bd">
      <div class="company-info-container">
        <img class="company-info-logo" src="~@/assets/logo.png" />
        <span class="company-info-name">Vue Admin</span>
      </div>
      <div class="company-info-desc">小具影响力的 Web 设计规范</div>
      <div class="account-login-mainer">
        <div class="login-tab-container">
          <div
            :class="['login-tab-item', { active: passwordMode }]"
            @click="passwordMode = !passwordMode"
          >
            账号密码登录
          </div>
          <div
            :class="['login-tab-item', { active: !passwordMode }]"
            @click="passwordMode = !passwordMode"
          >
            手机登录
          </div>
        </div>
        <div class="login-form-container">
          <div class="login-form-password" v-show="passwordMode">
            <el-form
              :model="passwordFrom"
              status-icon
              :rules="passwordRules"
              ref="passwordFrom"
            >
              <el-form-item prop="phone">
                <el-input
                  type="number"
                  prefix-icon="el-icon-mobile-phone"
                  placeholder="请输手机号"
                  v-model="passwordFrom.phone"
                  autocomplete="off"
                ></el-input>
              </el-form-item>
              <el-form-item prop="password">
                <el-input
                  type="password"
                  prefix-icon="el-icon-lock"
                  placeholder="请输入密码"
                  v-model="passwordFrom.password"
                  autocomplete="off"
                ></el-input>
              </el-form-item>
              <el-form-item prop="checked">
                <div class="flex-cell">
                  <el-checkbox
                    class="flex-cell-bd"
                    v-model="passwordFrom.checked"
                    >自动登录</el-checkbox
                  >
                </div>
              </el-form-item>
              <el-form-item>
                <el-button
                  type="primary"
                  style="width: 100%"
                  @click="submitForm('passwordFrom')"
                  >登录</el-button
                >
              </el-form-item>
            </el-form>
          </div>
          <div class="login-form-phone" v-show="!passwordMode">
            <el-form
              :model="smsFrom"
              status-icon
              :rules="smsRules"
              ref="smsFrom"
            >
              <el-form-item prop="phone">
                <el-input
                  type="number"
                  prefix-icon="el-icon-mobile-phone"
                  placeholder="请输手机号"
                  v-model="smsFrom.phone"
                  autocomplete="off"
                ></el-input>
              </el-form-item>
              <el-form-item prop="code">
                <div class="flex-cell">
                  <el-input
                    class="flex-cell-bd"
                    type="number"
                    placeholder="请输入验证码"
                    v-model="smsFrom.code"
                    autocomplete="off"
                    prefix-icon="el-icon-mobile"
                  ></el-input>
                  <el-button
                    :disabled="disabled"
                    class="flex-cell-ft"
                    @click="handleSendCode"
                    >{{ buttonName }}</el-button
                  >
                </div>
              </el-form-item>
              <el-form-item prop="checked">
                <div class="flex-cell">
                  <el-checkbox class="flex-cell-bd" v-model="smsFrom.checked"
                    >自动登录</el-checkbox
                  >
                </div>
              </el-form-item>
              <el-form-item>
                <el-button
                  type="primary"
                  style="width: 100%"
                  @click="submitForm('smsFrom')"
                  >登录</el-button
                >
              </el-form-item>
            </el-form>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      passwordMode: true,
      passwordFrom: {
        phone: "",
        password: "",
        checked: true
      },
      smsFrom: {
        phone: "",
        password: "",
        checked: true
      },
      smsRules: {
        phone: [
          { required: true, message: "请输入手机号", trigger: "blur" },
          {
            pattern: /^1[3456789]\d{9}$/,
            message: "目前只支持中国大陆的手机号码",
            trigger: "blur"
          }
        ],
        code: [{ required: true, message: "请输入验证码", trigger: "blur" }]
      },
      passwordRules: {
        phone: [
          { required: true, message: "请输入手机号", trigger: "blur" },
          {
            pattern: /^1[3456789]\d{9}$/,
            message: "目前只支持中国大陆的手机号码",
            trigger: "blur"
          }
        ],
        password: [{ required: true, message: "请输入密码", trigger: "blur" }]
      },
      buttonName: "获取验证码",
      disabled: false
    };
  },
  methods: {
    submitForm(formName) {
      this.$refs[formName].validate(valid => {
        if (valid) {
          if (formName === "passwordFrom") {
            this.$router.replace({ name: "DashboardGeneral" });
          } else {
            this.$router.replace({ name: "DashboardGeneral" });
          }
        }
      });
    },
    handleSendCode() {
      if (this.disabled) {
        return;
      }

      this.$refs.smsFrom.validateField("phone", errMsg => {
        if (errMsg) return;
        this.disabled = true;

        let time = 60;
        this.buttonName = `(${time})秒重新发送`;
        const interval = window.setInterval(() => {
          time -= 1;
          this.buttonName = `(${time})秒重新发送`;
          if (time <= 0) {
            this.buttonName = "重新发送";
            this.disabled = false;
            window.clearInterval(interval);
          }
        }, 1000);
      });
    }
  }
};
</script>

<style lang="less" scoped>
.flex-cell {
  display: flex;
  .flex-cell-bd {
    flex: 1;
  }
  .flex-cell-ft {
    width: 130px;
    margin-left: 8px;
    &:after {
      display: none;
    }
    &.link {
      font-size: 14px;
      font-weight: 500;
      text-align: center;
      color: #409eff;
      text-decoration: none;
    }
  }
}
.account-login-contaienr {
  display: flex;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #f0f2f5;
  background-position: center;
  padding-top: 40px;
  box-sizing: border-box;
}
.account-login-bd {
  flex: 1;
  padding: 32px 0;
}
.company-info-container {
  display: flex;
  justify-content: center;
  align-items: center;
  .company-info-logo {
    height: 44px;
    margin-right: 20px;
  }
  .company-info-name {
    line-height: 44px;
    font-size: 33px;
    font-weight: 600;
    font-family: Avenir;
  }
}
.company-info-desc {
  margin: 12px 0 40px;
  font-size: 14px;
  opacity: 0.5;
  text-align: center;
}
.account-login-mainer {
  max-width: 388px;
  margin: 40px auto;
}
.login-tab-container {
  text-align: center;
  margin-bottom: 24px;
  .login-tab-item {
    display: inline-block;
    position: relative;
    box-sizing: border-box;
    margin-right: 32px;
    padding: 12px 16px;
    cursor: pointer;
    font-size: 14px;
    line-height: 20px;
    color: #666;
    border-bottom: 2px solid transparent;
    transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
    &:last-child {
      margin-right: 0;
    }
    &.active {
      color: #1890ff;
      font-weight: 500;
      border-color: #1890ff;
    }
  }
}
</style>
```

<a name="Kz9ye"></a>
## 公共布局
在后台页面中会有公共的布局样式，例如左边导航，头部用户信息，脚部额外信息，各个不同页面在主体内容部分切换展示，因此我们来完成一个公共布局的 Layout 组件，并在后台页面中使用。

<a name="xQ6NB"></a>
### 创建布局 BasicLayout
首先在创建公共布局文件  src/components/BasicLayout.vue , 并完成结构与样式的书写。

```xml
<template>
  <div class="page-wrapper">
    <div class="page-sider">Sider</div>
    <div class="page-mainer">
      <div class="page-header">Header</div>
      <div class="page-body">
        <router-view></router-view>
      </div>
      <div class="page-footer">Footer</div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {};
  },
  components: {}
};
</script>

<style type="text/css" lang="less">
.page-wrapper {
  height: 100vh;
  background-color: #f0f2f5;
  display: flex;
}

.page-sider {
  position: relative;
  background-color: #fff;
  box-shadow: 2px 0 8px 0 rgba(29, 35, 41, 0.05);
  width: 240px;
}

.page-mainer {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.page-header {
  background-color: #fff;
  box-shadow: 0 2px 8px #f0f1f2;
  position: relative;
  z-index: 10;
  height: 64px;
}

.page-body {
  flex: 1;
}

.page-footer {
  text-align: center;
  font-size: 12px;
  line-height: 40px;
  opacity: 0.4;
}
</style>

```

<a name="bArFc"></a>
### 嵌套路由 BasicLayout
修改路由，把后台的页面路由都嵌套在根组件中。<br />参考 Vue-Router 嵌套路由 [https://router.vuejs.org/zh/guide/essentials/nested-routes.html](https://router.vuejs.org/zh/guide/essentials/nested-routes.html)

```javascript
const AccountLogin = () =>
  import(/* webpackChunkName: "account" */ "@/views/AccountLogin.vue");
const Dashboard = () =>
  import(/* webpackChunkName: "Dashboard" */ "@/views/Dashboard.vue");
const ArticleIndex = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleIndex.vue");
const ArticleClassify = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleClassify.vue");
const ArticleCreate = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleCreate.vue");
const ArticleEdit = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleEdit.vue");
const ArticleShow = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleShow.vue");
const SettingCompany = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingCompany.vue");
const SettingManager = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManager.vue");
const SettingManagerCreate = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerCreate.vue");
const SettingManagerEdit = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerEdit.vue");
const Error404 = () =>
  import(/* webpackChunkName: "errorp" */ "@/views/Error404.vue");

import BasicLayout from "@/components/BasicLayout.vue";

export default [
  {
    path: "/login",
    component: AccountLogin,
    name: "AccountLogin"
  },
  {
    path: "/",
    name: "Root",
    component: BasicLayout,
    redirect: { name: "Dashboard" },
    children: [
      {
        path: "/dashboard",
        name: "Dashboard",
        component: Dashboard
      },
      {
        path: "/article",
        name: "ArticleIndex",
        component: ArticleIndex
      },
      {
        path: "/article/classify",
        name: "ArticleClassify",
        component: ArticleClassify
      },
      {
        path: "/article/create",
        name: "ArticleCreate",
        component: ArticleCreate
      },
      {
        path: "/article/:id",
        name: "ArticleShow",
        component: ArticleShow
      },
      {
        path: "/article/:id/edit",
        name: "ArticleEdit",
        component: ArticleEdit
      },
      {
        path: "/setting/company",
        name: "SettingCompany",
        component: SettingCompany
      },
      {
        path: "/setting/manager",
        name: "SettingManager",
        component: SettingManager
      },
      {
        path: "/setting/manager/create",
        name: "SettingManagerCreate",
        component: SettingManagerCreate
      },
      {
        path: "/setting/manager/:id/edit",
        name: "SettingManagerEdit",
        component: SettingManagerEdit
      }
    ]
  },
  {
    path: "/404",
    name: "Error404",
    component: Error404
  },
  {
    path: "*",
    redirect: { name: "Error404" }
  }
];
```

之后访问后台的各个页面检查一下是否都嵌套成功，如下样式所示，带有公共的侧边栏、头部、底部：

![WeChatfa2774c66d606459b8f3b0a21fcd4af2.png](https://cdn.nlark.com/yuque/0/2019/png/166094/1560136285944-7668a68d-a080-4def-b187-6901c554f38b.png#align=left&display=inline&height=370&name=WeChatfa2774c66d606459b8f3b0a21fcd4af2.png&originHeight=1644&originWidth=3314&size=120498&status=done&width=746)

<a name="tPIuw"></a>
### 分离头部 BasicLayoutHeader
头部之后会包含切换按钮、面包屑、用户信息等其他内容，我们可以把它抽离到独立的组件中便于维护，创建布局的头部组件：src/components/BasicLayoutHeader.vue

```xml
<template>
  <div class="header-section">
    <div class="header-hd"></div>
    <div class="header-bd"></div>
    <div class="header-ft">
      <div class="bar-info-container">
        <i class="el-icon-question"></i>
      </div>
      <el-dropdown style="height: 100%;">
        <div class="bar-info-container">
          <i class="el-icon-user-solid userInfo-avatar"></i>
          <span class="userInfo-name">Jax</span>
          <i class="el-icon-arrow-down el-icon--right"></i>
        </div>
        <el-dropdown-menu slot="dropdown">
          <el-dropdown-item icon="el-icon-video-pause">退出</el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
    </div>
  </div>
</template>

<script>
export default {};
</script>

<style lang="less" scoped>
.header-section {
  position: relative;
  padding: 0 16px;
  height: 64px;
  display: flex;
  z-index: 10;
  background-color: #fff;
  box-shadow: 0 2px 8px #f0f1f2;
  .header-bd {
    flex: 1;
  }
}

.header-hd,
.header-bd,
.header-ft {
  display: flex;
  align-items: center;
}

.bar-info-container {
  display: flex;
  align-items: center;
  height: 100%;
  padding: 0 10px;
  transition: all 0.2s ease;
  cursor: pointer;
  &:hover {
    background-color: #ecf5ff;
  }
  .userInfo-name {
    font-size: 14px;
    vertical-align: middle;
  }
  .userInfo-avatar {
    display: inline-block;
    width: 20px;
    height: 20px;
    line-height: 20px;
    text-align: center;
    background-color: #ccc;
    border-radius: 50%;
    outline: none;
    margin: 0 10px;
  }
}
</style>
```

<a name="VCPdj"></a>
### 分离脚步 BasicLayoutFooter
同理分离脚部内容，创建布局的脚部组件：src/components/BasicLayoutFooter.vue

```xml
<template>
  <footer class="footer-section">
    Copyright © 2019 zakesi All Rights Reserved
  </footer>
</template>

<script>
export default {};
</script>

<style type="text/css" lang="less">
.footer-section {
  text-align: center;
  font-size: 12px;
  line-height: 40px;
  opacity: 0.4;
}
</style>
```

<a name="sDoxy"></a>
### 分离侧栏 BasicLayoutSider
同理分离侧边栏，创建布局的侧栏组件：src/components/BasicLayoutSider.vue

```xml
<template>
  <div class="sider-section">
    <div class="logo-section">
      <img class="logo-img" src="~@/assets/logo.png" alt="" />
      <span>Vue Element Pro</span>
    </div>
    <div class="menu-section"></div>
  </div>
</template>

<script>
export default {};
</script>

<style type="text/css" lang="less">
.sider-section {
  position: relative;
  width: 240px;
  background-color: #fff;
  box-shadow: 2px 0 8px 0 rgba(29, 35, 41, 0.05);
  transition: all 0.2s ease;
}

.logo-section {
  position: relative;
  height: 64px;
  background-color: #fff;
  box-shadow: 1px 1px 0 0 #e8e8e8;
  z-index: 1;
  padding-left: 14px;
  display: flex;
  align-items: center;
  font-family: Futura, Helvetica Neue For Number, -apple-system,
    BlinkMacSystemFont, Segoe UI, Roboto, PingFang SC, Hiragino Sans GB,
    Microsoft YaHei, Helvetica Neue, Helvetica, Arial, sans-serif;
  .logo-img {
    height: 40px;
    margin-right: 10px;
  }
}
</style>
```

<a name="qlDUj"></a>
### 引用组件 BasicLayout
在 BasicLayout 中引用我们分离的头部、脚部以及侧边栏组件。

```xml
<template>
  <div class="page-wrapper">
    <Sider class="page-sider" />
    <div class="page-mainer">
      <Header class="page-header" />
      <div class="page-body">
        <router-view></router-view>
      </div>
      <Footer class="page-footer" />
    </div>
  </div>
</template>

<script>
import Header from "./BasicLayoutHeader.vue";
import Footer from "./BasicLayoutFooter.vue";
import Sider from "./BasicLayoutSider.vue";

export default {
  data() {
    return {};
  },
  components: {
    Header,
    Footer,
    Sider
  }
};
</script>

<style type="text/css" lang="less">
.page-wrapper {
  height: 100vh;
  background-color: #f0f2f5;
  display: flex;
}

.page-mainer {
  flex: 1;
  display: flex;
  flex-direction: column;
  .page-body {
    flex: 1;
    padding: 20px;
  }
}
</style>
```

之后再次测试检查各路由展示是否正常。

<a name="FKn4s"></a>
## 动态导航
在后台公共的侧边栏是一个导航栏目，点击导航选项跳转到对应的页面，当然我们可以写死，但是写死不够灵活。现在我们就让它和我们的路由联动起来，我们可以在配置路由的时候，导航更具路由的变化而产生变化。

Element Menu 菜单导航可以参考一下文档：[https://element.eleme.io/#/zh-CN/component/menu](https://element.eleme.io/#/zh-CN/component/menu)

首先我们需要修改路由的嵌套规则，因为在导航中我们还涉及到二级导航。同时，我们在路由的 meta 信息中定义 nav 属性，属性中包含 icon 和 title 用于定义其导航的图表和标题。

<a name="BBjRT"></a>
### 结构化路由
修改 src/router/routes.js

```javascript
const AccountLogin = () =>
  import(/* webpackChunkName: "account" */ "@/views/AccountLogin.vue");
const Dashboard = () =>
  import(/* webpackChunkName: "Dashboard" */ "@/views/Dashboard.vue");
const ArticleIndex = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleIndex.vue");
const ArticleClassify = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleClassify.vue");
const ArticleCreate = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleCreate.vue");
const ArticleEdit = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleEdit.vue");
const ArticleShow = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleShow.vue");
const SettingCompany = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingCompany.vue");
const SettingManager = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManager.vue");
const SettingManagerCreate = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerCreate.vue");
const SettingManagerEdit = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerEdit.vue");
const Error404 = () =>
  import(/* webpackChunkName: "errorp" */ "@/views/Error404.vue");

import BasicLayout from "@/components/BasicLayout.vue";

export default [
  {
    path: "/login",
    component: AccountLogin,
    name: "AccountLogin"
  },
  {
    path: "/",
    name: "Root",
    component: BasicLayout,
    redirect: { name: "Dashboard" },
    children: [
      {
        path: "/dashboard",
        name: "Dashboard",
        component: Dashboard,
        meta: {
          nav: {
            icon: "el-icon-pie-chart",
            title: "概况"
          }
        }
      },
      {
        path: "/article",
        name: "ArticleRoot",
        component: { render: h => h("router-view") },
        meta: {
          nav: {
            icon: "el-icon-tickets",
            title: "文章"
          }
        },
        children: [
          {
            path: "/article/classify",
            name: "ArticleClassify",
            component: ArticleClassify,
            meta: {
              nav: {
                icon: "el-icon-paperclip",
                title: "文章分类"
              }
            }
          },
          {
            path: "/article",
            name: "ArticleIndex",
            component: ArticleIndex,
            meta: {
              nav: {
                icon: "el-icon-document-copy",
                title: "所有文章"
              }
            }
          },
          {
            path: "/article/create",
            name: "ArticleCreate",
            component: ArticleCreate,
            meta: {
              nav: {
                icon: "el-icon-document-add",
                title: "新建文章"
              }
            }
          },
          {
            path: "/article/:id",
            name: "ArticleShow",
            component: ArticleShow
          },
          {
            path: "/article/:id/edit",
            name: "ArticleEdit",
            component: ArticleEdit
          }
        ]
      },
      {
        path: "/setting",
        name: "settingRoot",
        component: { render: h => h("router-view") },
        meta: {
          nav: {
            icon: "el-icon-setting",
            title: "设置"
          }
        },
        children: [
          {
            path: "/setting/company",
            name: "SettingCompany",
            component: SettingCompany,
            meta: {
              nav: {
                icon: "el-icon-office-building",
                title: "公司设置"
              }
            }
          },
          {
            path: "/setting/manager",
            name: "SettingManagerRoot",
            component: { render: h => h("router-view") },
            redirect: { name: "SettingManager" },
            meta: {
              nav: {
                icon: "el-icon-user",
                title: "管理员设置"
              }
            },
            children: [
              {
                path: "/setting/manager",
                name: "SettingManager",
                component: SettingManager
              },
              {
                path: "/setting/manager/create",
                name: "SettingManagerCreate",
                component: SettingManagerCreate
              },
              {
                path: "/setting/manager/:id/edit",
                name: "SettingManagerEdit",
                component: SettingManagerEdit
              }
            ]
          }
        ]
      }
    ]
  },
  {
    path: "/404",
    name: "Error404",
    component: Error404
  },
  {
    path: "*",
    redirect: { name: "Error404" }
  }
];
```

<a name="3PG00"></a>
### 获取导航路由
然后创建菜单组件 src/componens/BasicLayoutSiderMenu.vue ，在 created 的时候引用 src/router/routers.js 的所有路由，然后和过滤出导航的结构，再用过滤出的导航在 template 模版中配合 element 的 el-submenu 、el-menu-item-group、el-menu-item 几个组件拼接出导航结构。

```xml
<template>
  <el-menu :default-active="path" :router="true">
    <template v-for="route in filterRoutes">
      <el-submenu
        v-if="hasNavChildren(route)"
        :index="route.path"
        :key="route.path"
      >
        <template slot="title">
          <i v-if="route.meta.nav.icon" :class="route.meta.nav.icon"></i>
          <span slot="title">{{ route.meta.nav.title }}</span>
        </template>
        <el-menu-item-group>
          <el-menu-item
            v-for="route in route.children"
            :key="route.path"
            :index="route.path"
            :route="{ path: route.path }"
            :id="route.name"
          >
            <i v-if="route.meta.nav.icon" :class="route.meta.nav.icon"></i>
            <span slot="title">{{ route.meta.nav.title }}</span>
          </el-menu-item>
        </el-menu-item-group>
      </el-submenu>

      <el-menu-item
        v-else
        :key="route.path"
        :disabled="route.disabled"
        :index="route.path"
        :route="{ path: route.path }"
        :id="route.name"
      >
        <i v-if="route.meta.nav.icon" :class="route.meta.nav.icon"></i>
        <span slot="title">{{ route.meta.nav.title }}</span>
      </el-menu-item>
    </template>
  </el-menu>
</template>

<script>
import routes from "@/router/routes";

export default {
  data() {
    return {
      path: this.$route.path,
      filterRoutes: []
    };
  },
  created() {
    this.getRoutes();
  },
  watch: {
    $route(to) {
      this.path = to.path;
    }
  },
  methods: {
    getRoutes() {
      this.filterRoutes = this.filterNavigator(routes);
    },
    filterNavigator(node) {
      let result = [];
      node.forEach(data => {
        if (data.meta && data.meta.nav) {
          let item = {
            path: data.path,
            name: data.name,
            meta: data.meta
          };
          if (data.children) {
            item.children = this.filterNavigator(data.children);
          }
          result.push(item);
        } else if (data.children) {
          this.filterNavigator(data.children).forEach(item =>
            result.push(item)
          );
        }
      });
      return result;
    },
    hasNavChildren(route) {
      const children = route.children || [];
      return children.some(data => data.meta && data.meta.nav);
    }
  }
};
</script>

<style lang="less">
.el-menu {
  border-right: none;
}
</style>
```

<a name="ReR6M"></a>
### 引用菜单组件
最后在 BasicLayoutSider 侧边栏组件中引用菜单组件

```xml
<template>
  <div class="sider-section">
    <div class="logo-section">
      <img class="logo-img" src="~@/assets/logo.png" alt="" />
      <span>Vue Element Pro</span>
    </div>
    <!-- 这里 -->
    <Menu class="menu-section" />
  </div>
</template>

<script>
import Menu from "./BasicLayoutSiderMenu.vue";

export default {
  components: {
    Menu
  }
};
</script>

<style type="text/css" lang="less">...</style>
```

<a name="zgbSG"></a>
### 路由分离
最后我们可以看到我们的 src/router/routes.js 的路由结构非常庞大，以后可能我们还会添加各类页面。因此我们最好做一个区分，区分通用路由和后台页面的路由，这样也方便下一步做权限的筛选和动态路由的添加管理。

创建公共路由 src/router/routesCommon.js

```javascript
const AccountLogin = () =>
  import(/* webpackChunkName: "account" */ "@/views/AccountLogin.vue");
const Error404 = () =>
  import(/* webpackChunkName: "errorp" */ "@/views/Error404.vue");

export default [
  {
    path: "/login",
    component: AccountLogin,
    name: "AccountLogin"
  },
  {
    path: "/404",
    name: "Error404",
    component: Error404
  },
  {
    path: "*",
    redirect: { name: "Error404" }
  }
];
```

创建后台路由 src/router/routesPermission.js

```javascript
const Dashboard = () =>
  import(/* webpackChunkName: "Dashboard" */ "@/views/Dashboard.vue");
const ArticleIndex = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleIndex.vue");
const ArticleClassify = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleClassify.vue");
const ArticleCreate = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleCreate.vue");
const ArticleEdit = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleEdit.vue");
const ArticleShow = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleShow.vue");
const SettingCompany = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingCompany.vue");
const SettingManager = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManager.vue");
const SettingManagerCreate = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerCreate.vue");
const SettingManagerEdit = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerEdit.vue");

import BasicLayout from "@/components/BasicLayout.vue";

export default [
  {
    path: "/",
    name: "Root",
    component: BasicLayout,
    redirect: { name: "Dashboard" },
    children: [
      {
        path: "/dashboard",
        name: "Dashboard",
        component: Dashboard,
        meta: {
          nav: {
            icon: "el-icon-pie-chart",
            title: "概况"
          }
        }
      },
      {
        path: "/article",
        name: "ArticleRoot",
        component: { render: h => h("router-view") },
        meta: {
          nav: {
            icon: "el-icon-tickets",
            title: "文章"
          }
        },
        children: [
          {
            path: "/article/classify",
            name: "ArticleClassify",
            component: ArticleClassify,
            meta: {
              nav: {
                icon: "el-icon-paperclip",
                title: "文章分类"
              }
            }
          },
          {
            path: "/article",
            name: "ArticleIndex",
            component: ArticleIndex,
            meta: {
              nav: {
                icon: "el-icon-document-copy",
                title: "所有文章"
              }
            }
          },
          {
            path: "/article/create",
            name: "ArticleCreate",
            component: ArticleCreate,
            meta: {
              nav: {
                icon: "el-icon-document-add",
                title: "新建文章"
              }
            }
          },
          {
            path: "/article/:id",
            name: "ArticleShow",
            component: ArticleShow
          },
          {
            path: "/article/:id/edit",
            name: "ArticleEdit",
            component: ArticleEdit
          }
        ]
      },
      {
        path: "/setting",
        name: "settingRoot",
        component: { render: h => h("router-view") },
        meta: {
          nav: {
            icon: "el-icon-setting",
            title: "设置"
          }
        },
        children: [
          {
            path: "/setting/company",
            name: "SettingCompany",
            component: SettingCompany,
            meta: {
              nav: {
                icon: "el-icon-office-building",
                title: "公司设置"
              }
            }
          },
          {
            path: "/setting/manager",
            name: "SettingManagerRoot",
            component: { render: h => h("router-view") },
            redirect: { name: "SettingManager" },
            meta: {
              nav: {
                icon: "el-icon-user",
                title: "管理员设置"
              }
            },
            children: [
              {
                path: "/setting/manager",
                name: "SettingManager",
                component: SettingManager
              },
              {
                path: "/setting/manager/create",
                name: "SettingManagerCreate",
                component: SettingManagerCreate
              },
              {
                path: "/setting/manager/:id/edit",
                name: "SettingManagerEdit",
                component: SettingManagerEdit
              }
            ]
          }
        ]
      }
    ]
  }
];
```

修改 src/router/routes.js ，引用并合成输出。

```javascript
import RoutesCommon from "./routesCommon.js";
import RoutesPermission from "./routesPermission.js";

export default RoutesPermission.concat(RoutesCommon);
```

这个时候我们也可以修改菜单组件 src/components/BasicLayoutSiderMenu.vue 对路由的引用，可以直接引用后台路由，这样可以减少循环次数。

```javascript
// import routes from "@/router/routes";
import routes from "@/router/routesPermission";
```

<a name="oOpqO"></a>
## 动态面包屑
和动态导航的原理类似我们通过在路由的 meta 对象中存放面包屑的信息，如果有就把面包屑信息通过路由的 $route.matched 过滤获得，然后循环渲染出面包屑试图。

<a name="uTPe6"></a>
### 添加面包屑信息
修改 src/router/routesPermission.js ，如果该导航需要添加面包屑的话在其 meta 数据中添加 breadcrumb 属性，breadcrumb 的值为对象，包含 title 显示内容以及 replace 是否可以点击跳转。

```javascript
const Dashboard = () =>
  import(/* webpackChunkName: "Dashboard" */ "@/views/Dashboard.vue");
const ArticleIndex = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleIndex.vue");
const ArticleClassify = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleClassify.vue");
const ArticleCreate = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleCreate.vue");
const ArticleEdit = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleEdit.vue");
const ArticleShow = () =>
  import(/* webpackChunkName: "article" */ "@/views/ArticleShow.vue");
const SettingCompany = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingCompany.vue");
const SettingManager = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManager.vue");
const SettingManagerCreate = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerCreate.vue");
const SettingManagerEdit = () =>
  import(/* webpackChunkName: "setting" */ "@/views/SettingManagerEdit.vue");

import BasicLayout from "@/components/BasicLayout.vue";

export default [
  {
    path: "/",
    name: "Root",
    component: BasicLayout,
    redirect: { name: "Dashboard" },
    children: [
      {
        path: "/dashboard",
        name: "Dashboard",
        component: Dashboard,
        meta: {
          nav: {
            icon: "el-icon-pie-chart",
            title: "概况"
          },
          breadcrumb: {
            title: "概况"
          }
        }
      },
      {
        path: "/article",
        name: "ArticleRoot",
        component: { render: h => h("router-view") },
        meta: {
          nav: {
            icon: "el-icon-tickets",
            title: "文章"
          },
          breadcrumb: {
            title: "文章"
          }
        },
        children: [
          {
            path: "/article/classify",
            name: "ArticleClassify",
            component: ArticleClassify,
            meta: {
              nav: {
                icon: "el-icon-paperclip",
                title: "文章分类"
              },
              breadcrumb: {
                title: "分类"
              }
            }
          },
          {
            path: "/article",
            name: "ArticleIndex",
            component: ArticleIndex,
            meta: {
              nav: {
                icon: "el-icon-document-copy",
                title: "所有文章"
              },
              breadcrumb: {
                title: "所有"
              }
            }
          },
          {
            path: "/article/create",
            name: "ArticleCreate",
            component: ArticleCreate,
            meta: {
              nav: {
                icon: "el-icon-document-add",
                title: "新建文章"
              },
              breadcrumb: {
                title: "新建"
              }
            }
          },
          {
            path: "/article/:id",
            name: "ArticleShow",
            component: ArticleShow,
            meta: {
              breadcrumb: {
                title: "详情"
              }
            }
          },
          {
            path: "/article/:id/edit",
            name: "ArticleEdit",
            component: ArticleEdit,
            meta: {
              breadcrumb: {
                title: "编辑"
              }
            }
          }
        ]
      },
      {
        path: "/setting",
        name: "settingRoot",
        component: { render: h => h("router-view") },
        meta: {
          nav: {
            icon: "el-icon-setting",
            title: "设置"
          },
          breadcrumb: {
            title: "设置"
          }
        },
        children: [
          {
            path: "/setting/company",
            name: "SettingCompany",
            component: SettingCompany,
            meta: {
              nav: {
                icon: "el-icon-office-building",
                title: "公司设置"
              },
              breadcrumb: {
                title: "公司"
              }
            }
          },
          {
            path: "/setting/manager",
            name: "SettingManagerRoot",
            component: { render: h => h("router-view") },
            redirect: { name: "SettingManager" },
            meta: {
              nav: {
                icon: "el-icon-user",
                title: "管理员设置"
              },
              breadcrumb: {
                title: "管理员",
                replace: true
              }
            },
            children: [
              {
                path: "/setting/manager",
                name: "SettingManager",
                component: SettingManager
              },
              {
                path: "/setting/manager/create",
                name: "SettingManagerCreate",
                component: SettingManagerCreate,
                meta: {
                  breadcrumb: {
                    title: "创建"
                  }
                }
              },
              {
                path: "/setting/manager/:id/edit",
                name: "SettingManagerEdit",
                component: SettingManagerEdit,
                meta: {
                  breadcrumb: {
                    title: "编辑"
                  }
                }
              }
            ]
          }
        ]
      }
    ]
  }
];
```

<a name="JkW8G"></a>
### 创建面包屑组件
创建 src/components/BasicBreadcrumb.vue ，通过 breadcrumbValue 计算属性返回值渲染试图，其计算规则为如果有传入的数据结构就优先显示传入的，否则通过路由 matched 匹配其父级路由的数据并过滤出面包屑数据进行展示。

```javascript
<template>
  <div
    class="breadcrumb-section"
    v-if="breadcrumbValue.length || title || description"
  >
    <el-breadcrumb class="breadcrumb-list" v-if="breadcrumbValue.length">
      <template v-for="item in breadcrumbValue">
        <el-breadcrumb-item
          v-if="item.to"
          :replace="true"
          :key="item.name"
          :to="item.to"
          >{{ item.name }}</el-breadcrumb-item
        >
        <el-breadcrumb-item v-else :key="item.name">{{
          item.name
        }}</el-breadcrumb-item>
      </template>
    </el-breadcrumb>
  </div>
</template>

<script>
/*
 * @params breadcrumb
 * @params breadcrumb.name
 * @params breadcrumb.to
 */
export default {
  props: {
    breadcrumb: {
      type: Array,
      default: () => []
    }
  },
  computed: {
    breadcrumbValue() {
      const { breadcrumb } = this;
      if (breadcrumb.length) {
        return breadcrumb;
      }
      return this.$route.matched
        .filter(data => data.meta && data.meta.breadcrumb)
        .map(data => ({
          name: data.meta.breadcrumb.title,
          to: data.meta.breadcrumb.replace ? { name: data.name } : undefined
        }));
    }
  }
};
</script>

<style lang="less">
.breadcrumb-section {
  background-color: #fff;
  padding: 16px 32px;
  padding-bottom: 0;
  overflow: hidden;
  flex: none;
  .breadcrumb-list,
  .breadcrumb-title,
  .breadcrumb-description {
    margin-bottom: 16px;
  }
}
</style>
```

<a name="UaLaM"></a>
### 引用面包屑组件
最后在 BasicLayoutHeader 组件中引用面包屑组件，这样所匹配到的页面都可以通过路由配置面包屑信息了。

```javascript
<template>
  <div class="header-section">
    <div class="header-hd">
      <!-- 这里 -->
      <Breadcrumb />
    </div>
		...
  </div>
</template>

<script>
// 这里
import Breadcrumb from "@/components/BasicBreadcrumb.vue";
export default {
  components: {
    Breadcrumb
  }
};
</script>

<style lang="less" scoped>...</style>

```

